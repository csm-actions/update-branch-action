name: Update Branch securely
description: Update Branch securely
author: Shunsuke Suzuki
branding:
  icon: git-commit
  color: green
inputs:
  app_id:
    description: |
      GitHub App ID
    required: true
  app_private_key:
    description: |
      GitHub App Private Key
    required: true
  server_repository:
    description: |
      Server repository name
    required: true

  repository:
    description: |
      The repository name of the updated pull request
    required: false
  pull_request_number:
    description: |
      The pull request number of the updated pull request
    required: false
    default: ${{github.event.pull_request.number}}
runs:
  using: composite
  steps:
    # Create a GitHub App token to create and delete a label
    - uses: actions/create-github-app-token@df432ceedc7162793a195dd1713ff69aefc7379e # v2.0.6
      id: token
      with:
        app-id: ${{inputs.app_id}}
        private-key: ${{inputs.app_private_key}}
        permission-issues: write
        owner: ${{ github.repository_owner }}
        repositories: |
          ${{inputs.server_repository}}

    - uses: securefix-action/label-action@c0244604f0f8bb3ff8136e650d2161b6714aea72 # v0.0.1
      with:
        prefix: update-branch-
        description: ${{github.repository_owner}}/${{inputs.repository && inputs.repository || github.event.repository.name}}/${{inputs.pull_request_number}}
        repository: ${{inputs.server_repository}}
        github_token: ${{steps.token.outputs.token}}
